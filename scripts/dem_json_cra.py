import pathlib

import compas

from compas_dem.analysis.cra import cra_penalty_solve
from compas_dem.models import BlockModel
from compas_dem.viewer import DEMViewer

# =============================================================================
# Import
# =============================================================================

model: BlockModel = compas.json_load(pathlib.Path(__file__).parent / "Masonry_DEM.json")  # type: ignore

# =============================================================================
# Contacts
# =============================================================================

model.compute_contacts(tolerance=0.001)

# =============================================================================
# Supports
# =============================================================================

# =============================================================================
# Equilibrium
# =============================================================================

cra_penalty_solve(model)

# =============================================================================
# Viz
# =============================================================================

viewer = DEMViewer(model)
viewer.setup()
viewer.show()
